<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Computation of the intercept &#8212; skglm 0.3.dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="What’s new" href="whats_new.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          skglm</a>
        <span class="navbar-text navbar-version pull-left"><b>0.3.dev</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="auto_examples/index.html">Examples</a></li>
                <li><a href="api.html">API</a></li>
                <li><a href="add_datafit.html">Add custom datafit</a></li>
                <li><a href="add_penalty.html">Add custom penalty</a></li>
                <li><a href="https://github.com/scikit-learn-contrib/skglm">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whats_new.html">What’s new</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Computation of the intercept</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="computation-of-the-intercept">
<span id="intercept"></span><h1>Computation of the intercept<a class="headerlink" href="#computation-of-the-intercept" title="Permalink to this heading">¶</a></h1>
<p>This note gives insights and guidance for the handling of an intercept coefficient within the <span class="math notranslate nohighlight">\(\texttt{skglm}\)</span> solvers.</p>
<p>Let the design matrix be <span class="math notranslate nohighlight">\(X\in \mathbb{R}^{n\times p}\)</span> where <span class="math notranslate nohighlight">\(n\)</span> is the number of samples and <span class="math notranslate nohighlight">\(p\)</span> the number of features.
We denote <span class="math notranslate nohighlight">\(\beta\in\mathbb{R}^p\)</span> the coefficients of the Generalized Linear Model and <span class="math notranslate nohighlight">\(\beta_0\)</span> its intercept.
In many packages such as <code class="docutils literal notranslate"><span class="pre">liblinear</span></code>, the intercept is handled by adding an extra column of ones in the design matrix. This is costly in memory, and may lead to different solutions if all coefficients are penalized, as the intercept <span class="math notranslate nohighlight">\(\beta_0\)</span> is usually not.
<code class="docutils literal notranslate"><span class="pre">skglm</span></code> follows a different route and solves directly:</p>
<div class="amsmath math notranslate nohighlight" id="equation-639eac43-4586-4d2c-9b98-efa3e4c229cb">
<span class="eqno">(1)<a class="headerlink" href="#equation-639eac43-4586-4d2c-9b98-efa3e4c229cb" title="Permalink to this equation">¶</a></span>\[\begin{align}
    \beta^\star, \beta_0^\star
    \in
    \underset{\beta \in \mathbb{R}^p, \beta_0 \in \mathbb{R}}{\text{argmin}}
    \Phi(\beta)
    \triangleq
    \underbrace{F(X\beta + \beta_0\boldsymbol{1}_{n})}_{\triangleq f(\beta, \beta_0)}
    + \sum_{j=1}^p g_j(\beta_j)
    \enspace ,
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{1}_{n}\)</span> is the vector of size <span class="math notranslate nohighlight">\(n\)</span> composed only of ones.</p>
<p>The solvers of <code class="docutils literal notranslate"><span class="pre">skglm</span></code> update the intercept after each update of <span class="math notranslate nohighlight">\(\beta\)</span> by doing a (1 dimensional) gradient descent update:</p>
<div class="amsmath math notranslate nohighlight" id="equation-32064029-e5ef-4f46-9b44-306242fd8468">
<span class="eqno">(2)<a class="headerlink" href="#equation-32064029-e5ef-4f46-9b44-306242fd8468" title="Permalink to this equation">¶</a></span>\[\begin{align}
    \beta^{(k+1)}_0 = \beta^{(k)}_0 - \frac{1}{L_0}\nabla_{\beta_0}F(X\beta^{(k)} + \beta_0^{(k)}\boldsymbol{1}_{n})
    \enspace ,
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(L_0\)</span> is the Lipschitz constant associated to the intercept.
The local Lipschitz constant <span class="math notranslate nohighlight">\(L_0\)</span> statisfies the following inequality</p>
<div class="math notranslate nohighlight">
\[
\forall x, x_0\in \mathbb{R}^p \times \mathbb{R}, \forall h \in \mathbb{R}, |\nabla_{x_0} f(x, x_0 + h) - \nabla_{x_0} f(x, x_0)| \leq L_0 |h| \enspace .
\]</div>
<p>This update rule should be implemented in the <code class="docutils literal notranslate"><span class="pre">intercept_update_step</span></code> method of the datafit class.</p>
<p>The convergence criterion computed for the gradient is then only the absolute value of the gradient with respect to <span class="math notranslate nohighlight">\(\beta_0\)</span> since the intercept optimality condition, for a solution <span class="math notranslate nohighlight">\(\beta^\star\)</span>, <span class="math notranslate nohighlight">\(\beta_0^\star\)</span> is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-96b55f48-26f8-422e-bdcf-4f4eb22537ef">
<span class="eqno">(3)<a class="headerlink" href="#equation-96b55f48-26f8-422e-bdcf-4f4eb22537ef" title="Permalink to this equation">¶</a></span>\[\begin{align}
    \nabla_{\beta_0}F(X\beta^\star + \beta_0^\star\boldsymbol{1}_{n}) = 0
    \enspace ,
\end{align}\]</div>
<p>Moreover, we have that</p>
<div class="amsmath math notranslate nohighlight" id="equation-7992edc7-a601-492d-9f40-049f20f25b7c">
<span class="eqno">(4)<a class="headerlink" href="#equation-7992edc7-a601-492d-9f40-049f20f25b7c" title="Permalink to this equation">¶</a></span>\[\begin{align}
    \nabla_{\beta_0}F(X\beta + \beta_0\boldsymbol{1}_{n}) = \boldsymbol{1}_{n}^\top \nabla_\beta F(X\beta + \beta_0\boldsymbol{1}_{n})
    \enspace .
\end{align}\]</div>
<p>We will now derive the update used in Equation 2 for three different datafitting functions.</p>
<hr class="docutils" />
<section id="the-quadratic-datafit">
<h2>The Quadratic datafit<a class="headerlink" href="#the-quadratic-datafit" title="Permalink to this heading">¶</a></h2>
<p>We define</p>
<div class="amsmath math notranslate nohighlight" id="equation-249fafa6-d86a-4c80-9a33-b379a48cb850">
<span class="eqno">(5)<a class="headerlink" href="#equation-249fafa6-d86a-4c80-9a33-b379a48cb850" title="Permalink to this equation">¶</a></span>\[\begin{align}
    F(X\beta + \beta_0\boldsymbol{1}_{n}) = \frac{1}{2n} \lVert y - X\beta - \beta_0\boldsymbol{1}_{n} \rVert^2_2
    \enspace .
\end{align}\]</div>
<p>In this case <span class="math notranslate nohighlight">\(\nabla f(z) = \frac{1}{n}(z - y)\)</span> hence Eq. 4 is equal to:</p>
<div class="amsmath math notranslate nohighlight" id="equation-285da751-ae15-43da-8855-eace8391a208">
<span class="eqno">(6)<a class="headerlink" href="#equation-285da751-ae15-43da-8855-eace8391a208" title="Permalink to this equation">¶</a></span>\[\begin{align}
    \nabla_{\beta_0}F(X\beta + \beta_0\boldsymbol{1}_{n}) = \frac{1}{n}\sum_{i=1}^n(X_{i:}\beta + \beta_0 - y_i)
    \enspace .
\end{align}\]</div>
<p>Finally, the Lipschitz constant is <span class="math notranslate nohighlight">\(L_0 = \frac{1}{n}\sum_{i=1}^n 1^2 = 1\)</span>.</p>
<hr class="docutils" />
</section>
<section id="the-logistic-datafit">
<h2>The Logistic datafit<a class="headerlink" href="#the-logistic-datafit" title="Permalink to this heading">¶</a></h2>
<p>In this case,</p>
<div class="amsmath math notranslate nohighlight" id="equation-5da1133c-1200-4d93-8c74-c19587dce120">
<span class="eqno">(7)<a class="headerlink" href="#equation-5da1133c-1200-4d93-8c74-c19587dce120" title="Permalink to this equation">¶</a></span>\[\begin{align}
    F(X\beta + \beta_0\boldsymbol{1}_{n}) = \frac{1}{n} \sum_{i=1}^n \log(1 + \exp(-y_i(X_{i:}\beta + \beta_0\boldsymbol{1}_n))
\end{align}\]</div>
<p>We can then write</p>
<div class="amsmath math notranslate nohighlight" id="equation-e502a362-390a-400d-ac49-d8bc85a88a49">
<span class="eqno">(8)<a class="headerlink" href="#equation-e502a362-390a-400d-ac49-d8bc85a88a49" title="Permalink to this equation">¶</a></span>\[\begin{align}
 \nabla_{\beta_0}F(X\beta + \beta_0\boldsymbol{1}_{n}) = \frac{1}{n} \sum_{i=1}^n  \frac{-y_i}{1 + \exp(- y_i(X_{i:}\beta + \beta_0\boldsymbol{1}_n))} \enspace .
\end{align}\]</div>
<p>Finally, the Lipschitz constant is <span class="math notranslate nohighlight">\(L_0 = \frac{1}{4n}\sum_{i=1}^n 1^2 = \frac{1}{4}\)</span>.</p>
<hr class="docutils" />
</section>
<section id="the-huber-datafit">
<h2>The Huber datafit<a class="headerlink" href="#the-huber-datafit" title="Permalink to this heading">¶</a></h2>
<p>In this case,</p>
<div class="amsmath math notranslate nohighlight" id="equation-29bdea61-0872-4ef8-a7e3-8bdae98495fd">
<span class="eqno">(9)<a class="headerlink" href="#equation-29bdea61-0872-4ef8-a7e3-8bdae98495fd" title="Permalink to this equation">¶</a></span>\[\begin{align}
    F(X\beta + \beta_0\boldsymbol{1}_{n}) = \frac{1}{n} \sum_{i=1}^n f_{\delta}(y_i - X_{i:}\beta - \beta_0\boldsymbol{1}_n)) \enspace ,
\end{align}\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight" id="equation-4aada74b-ca59-4e8c-b1f7-687478dd4700">
<span class="eqno">(10)<a class="headerlink" href="#equation-4aada74b-ca59-4e8c-b1f7-687478dd4700" title="Permalink to this equation">¶</a></span>\[\begin{align}
    f_\delta(x) = \begin{cases}
            \frac{1}{2}x^2 &amp; \text{if } x \leq \delta \\
            \delta |x| - \frac{1}{2}\delta^2 &amp; \text{if } x &gt; \delta
           \end{cases} \enspace .
\end{align}\]</div>
<p>Let <span class="math notranslate nohighlight">\(r_i = y_i - X_{i:}\beta - \beta_0\boldsymbol{1}_n\)</span>. We can then write</p>
<div class="amsmath math notranslate nohighlight" id="equation-3b9629a3-7e13-4d60-8e33-56931f963680">
<span class="eqno">(11)<a class="headerlink" href="#equation-3b9629a3-7e13-4d60-8e33-56931f963680" title="Permalink to this equation">¶</a></span>\[\begin{align}
 \nabla_{\beta_0}F(X\beta + \beta_0\boldsymbol{1}_{n}) = \frac{1}{n} \sum_{i=1}^n r_i\mathbb{1}_{\{|r_i|\leq\delta\}} + \text{sign}(r_i)\delta\mathbb{1}_{\{|r_i|&gt;\delta\}} \enspace ,
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(1_{x &gt; \delta}\)</span> is the classical indicator function.</p>
<p>Finally, the Lipschitz constant is <span class="math notranslate nohighlight">\(L_0 = \frac{1}{n}\sum_{i=1}^n 1^2 = 1\)</span>.</p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2022, skglm developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>